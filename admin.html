<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Atualizar Dados</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a1f2e 50%, #0d1117 100%);
            min-height: 100vh;
            color: #ffffff;
            padding: 40px 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 32px;
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: #6b7280;
            font-size: 16px;
        }

        .card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .link-box {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(59, 130, 246, 0.4);
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #60a5fa;
            word-break: break-all;
            margin-bottom: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e5e7eb;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }

        textarea {
            width: 100%;
            min-height: 350px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            color: #e5e7eb;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert-success {
            background: rgba(34, 197, 94, 0.15);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #4ade80;
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #f87171;
        }

        .alert-info {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #60a5fa;
        }

        .hidden {
            display: none;
        }

        .config-section {
            margin-bottom: 20px;
        }

        .config-section label {
            display: block;
            font-size: 13px;
            color: #9ca3af;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .config-section input {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            font-family: inherit;
        }

        .config-section input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }

        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            font-size: 14px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .tab.active {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        .tab:hover {
            color: #e5e7eb;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .method-content {
            display: none;
        }

        .method-content.active {
            display: block;
        }

        pre {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
            color: #9ca3af;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öôÔ∏è Dashboard Admin</h1>
            <p>Atualize os dados da TV Corporativa</p>
        </div>

        <div id="alertBox" class="alert alert-info hidden"></div>

        <div class="card">
            <div class="card-title">üì∫ Link da TV Corporativa</div>
            <div class="link-box">https://dashvendasyourh.netlify.app/</div>
            <button class="btn btn-primary" onclick="copiarLink()">üìã Copiar Link</button>
            <button class="btn btn-secondary" onclick="verTV()">üëÅÔ∏è Visualizar TV</button>
            <p style="margin-top: 15px; color: #6b7280; font-size: 13px;">
                üí° Configure este link UMA VEZ na TV. Depois √© s√≥ atualizar os dados abaixo.
            </p>
        </div>

        <div class="card">
            <div class="card-title">üìù Atualizar Dados</div>
            
            <div class="tabs">
                <button class="tab active" onclick="switchTab('github')">GitHub (Autom√°tico)</button>
                <button class="tab" onclick="switchTab('manual')">Download Manual</button>
                <button class="tab" onclick="switchTab('api')">API/Integra√ß√£o</button>
            </div>

            <div id="github" class="method-content active">
                <div class="config-section">
                    <label>Token de Acesso Pessoal do GitHub</label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                    <p style="font-size: 12px; color: #6b7280; margin-top: 5px;">
                        <a href="https://github.com/settings/tokens/new" target="_blank" style="color: #60a5fa;">Criar token aqui</a> 
                        (marque a permiss√£o 'repo')
                    </p>
                </div>
                
                <div class="config-section">
                    <label>Usu√°rio/Reposit√≥rio</label>
                    <input type="text" id="repoName" placeholder="usuario/dashboard-vendas">
                </div>

                <textarea id="jsonInputGithub" placeholder="Cole o JSON aqui..."></textarea>
                
                <div style="margin-top: 15px;">
                    <button class="btn btn-primary" id="btnGithub" onclick="atualizarViaGithub()">
                        üöÄ Atualizar Automaticamente
                    </button>
                    <button class="btn btn-secondary" onclick="carregarExemplo('github')">üìã Exemplo</button>
                </div>
            </div>

            <div id="manual" class="method-content">
                <p style="color: #9ca3af; margin-bottom: 15px; font-size: 14px;">
                    Edite o JSON abaixo e fa√ßa o download. Depois suba o arquivo <code>dados.json</code> na raiz do seu reposit√≥rio.
                </p>
                
                <textarea id="jsonInputManual" placeholder="Cole o JSON aqui..."></textarea>
                
                <div style="margin-top: 15px;">
                    <button class="btn btn-success" onclick="downloadJson()">
                        üíæ Baixar dados.json
                    </button>
                    <button class="btn btn-secondary" onclick="carregarExemplo('manual')">üìã Exemplo</button>
                    <button class="btn btn-secondary" onclick="carregarAtual()">üîÑ Carregar Atual</button>
                </div>
            </div>

            <div id="api" class="method-content">
                <p style="color: #9ca3af; margin-bottom: 15px; font-size: 14px;">
                    Endpoint para integra√ß√£o autom√°tica (POST):
                </p>
                <pre>POST https://seu-site.netlify/.netlify/functions/atualizar-dados
Content-Type: application/json

{
  "token": "seu-token-secreto",
  "dados": { ... }
}</pre>
                <p style="color: #6b7280; margin-top: 15px; font-size: 13px;">
                    üìö <a href="#" style="color: #60a5fa;">Ver documenta√ß√£o completa</a>
                </p>
            </div>
        </div>

        <div class="card">
            <div class="card-title">üìã Estrutura do JSON</div>
            <pre>{
  "mes": "Fevereiro 2026",
  "nmrr": { "atual": 9000, "meta": 32000, "variacao": 990 },
  "vendas": { "atual": 4, "meta": 20, "variacao": 2 },
  "conversao": { "atual": 12.5, "meta": 22, "variacao": 4.17 },
  "pipelineMorno": { "valor": 11313.8, "meta": 32000 },
  "pipelineQuente": { "valor": 6514.26, "meta": 32000 },
  "agendas": { "atual": 59, "meta": 178 },
  "sqlsInbound": { "atual": 35, "meta": 120 },
  "sqlsOutbound": { "atual": 14, "meta": 36 },
  "mensagem": "Pipeline aquecendo! Hora de transformar oportunidades em resultados!"
}</pre>
        </div>
    </div>

    <script>
        window.onload = async function() {
            try {
                const response = await fetch('dados.json?t=' + Date.now());
                if (response.ok) {
                    const dados = await response.json();
                    const jsonStr = JSON.stringify(dados, null, 2);
                    document.getElementById('jsonInputGithub').value = jsonStr;
                    document.getElementById('jsonInputManual').value = jsonStr;
                }
            } catch (e) {
                console.log('Nenhum dado existente');
                carregarExemplo('github');
                carregarExemplo('manual');
            }
        };

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.method-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab).classList.add('active');
        }

        function showAlert(mensagem, tipo) {
            const alert = document.getElementById('alertBox');
            alert.textContent = mensagem;
            alert.className = 'alert alert-' + tipo;
            alert.classList.remove('hidden');
            setTimeout(() => alert.classList.add('hidden'), 5000);
        }

        function copiarLink() {
            navigator.clipboard.writeText('https://dashvendasyourh.netlify.app/');
            showAlert('Link copiado!', 'success');
        }

        function verTV() {
            window.open('https://dashvendasyourh.netlify.app/', '_blank');
        }

        function carregarExemplo(method) {
            const exemplo = {
                mes: "Fevereiro 2026",
                nmrr: { atual: 172450, meta: 210000, variacao: 15000 },
                vendas: { atual: 52, meta: 65, variacao: 8 },
                conversao: { atual: 28.7, meta: 32, variacao: 5.2 },
                pipelineMorno: { valor: 384920, meta: 550000 },
                pipelineQuente: { valor: 267300, meta: 520000 },
                agendas: { atual: 145, meta: 200 },
                sqlsInbound: { atual: 89, meta: 150 },
                sqlsOutbound: { atual: 34, meta: 80 },
                mensagem: "Estamos acelerando forte! Mantendo esse ritmo, a meta fica totalmente alcan√ß√°vel."
            };
            const jsonStr = JSON.stringify(exemplo, null, 2);
            
            if (method === 'github') {
                document.getElementById('jsonInputGithub').value = jsonStr;
            } else {
                document.getElementById('jsonInputManual').value = jsonStr;
            }
        }

        async function carregarAtual() {
            try {
                const response = await fetch('dados.json?t=' + Date.now());
                if (response.ok) {
                    const dados = await response.json();
                    document.getElementById('jsonInputManual').value = JSON.stringify(dados, null, 2);
                    showAlert('Dados atuais carregados!', 'success');
                }
            } catch (e) {
                showAlert('Erro ao carregar dados atuais', 'error');
            }
        }

        function downloadJson() {
            const input = document.getElementById('jsonInputManual').value.trim();
            if (!input) {
                showAlert('Cole o JSON primeiro!', 'error');
                return;
            }

            try {
                const dados = JSON.parse(input);
                const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'dados.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showAlert('Arquivo baixado! Suba no seu reposit√≥rio.', 'success');
            } catch (e) {
                showAlert('JSON inv√°lido: ' + e.message, 'error');
            }
        }

        async function atualizarViaGithub() {
            const token = document.getElementById('githubToken').value.trim();
            const repo = document.getElementById('repoName').value.trim();
            const input = document.getElementById('jsonInputGithub').value.trim();
            const btn = document.getElementById('btnGithub');

            if (!token || !repo || !input) {
                showAlert('Preencha todos os campos!', 'error');
                return;
            }

            try {
                const dados = JSON.parse(input);
                btn.disabled = true;
                btn.innerHTML = '<span class="spinner"></span> Atualizando...';

                const getResponse = await fetch(`https://api.github.com/repos/${repo}/contents/dados.json`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!getResponse.ok) {
                    throw new Error('Reposit√≥rio ou arquivo n√£o encontrado. Verifique o nome do repo.');
                }

                const fileData = await getResponse.json();
                const sha = fileData.sha;

                const content = btoa(JSON.stringify(dados, null, 2));
                const updateResponse = await fetch(`https://api.github.com/repos/${repo}/contents/dados.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Atualiza√ß√£o de dados via Dashboard Admin',
                        content: content,
                        sha: sha
                    })
                });

                if (updateResponse.ok) {
                    showAlert('‚úÖ Sucesso! Dados atualizados. A TV atualizar√° em 1-2 minutos.', 'success');
                } else {
                    const error = await updateResponse.json();
                    throw new Error(error.message || 'Erro ao atualizar');
                }

            } catch (e) {
                showAlert('Erro: ' + e.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'üöÄ Atualizar Automaticamente';
            }
        }

        document.getElementById('jsonInputGithub').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') atualizarViaGithub();
        });
    </script>
</body>
</html>
