<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="300"> <!-- Atualiza a cada 5 minutos opcional -->
    <title>Dashboard de Vendas - TV Corporativa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: white;
            overflow: hidden;
        }

        .dashboard {
            display: grid;
            grid-template-rows: auto 1fr auto;
            height: 100vh;
            padding: 40px;
            gap: 30px;
        }

        header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .mes-atual {
            font-size: 1.5em;
            opacity: 0.9;
            background: rgba(255,255,255,0.1);
            display: inline-block;
            padding: 10px 30px;
            border-radius: 30px;
        }

        .grid-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            align-content: center;
        }

        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.15);
        }

        .card-title {
            font-size: 1.2em;
            opacity: 0.8;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .card-value {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .card-meta {
            font-size: 1.1em;
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .variacao {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1em;
        }

        .positivo {
            background: #28a745;
        }

        .negativo {
            background: #dc3545;
        }

        .neutro {
            background: #ffc107;
            color: #333;
        }

        .pipelines {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .pipeline-card {
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid;
        }

        .pipeline-morno {
            border-left-color: #ffc107;
        }

        .pipeline-quente {
            border-left-color: #ff6b6b;
        }

        .pipeline-title {
            font-size: 1.3em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pipeline-value {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        footer {
            text-align: center;
            padding-top: 20px;
            border-top: 2px solid rgba(255,255,255,0.2);
        }

        .mensagem-motivacional {
            font-size: 1.8em;
            font-style: italic;
            opacity: 0.95;
            animation: pulse 3s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.95; }
            50% { opacity: 0.7; }
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 2em;
        }

        .erro-dados {
            text-align: center;
            padding: 50px;
            background: rgba(220, 53, 69, 0.3);
            border-radius: 20px;
            margin: 20px;
        }

        /* Responsividade para TVs */
        @media (min-width: 1920px) {
            .card-value { font-size: 4em; }
            .mensagem-motivacional { font-size: 2.2em; }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading">Carregando dashboard...</div>
    </div>

    <script>
        // Fun√ß√£o para formatar moeda
        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 0
            }).format(valor);
        }

        // Fun√ß√£o para calcular varia√ß√£o
        function calcularVariacao(atual, meta) {
            const diff = atual - meta;
            const percent = ((atual / meta) - 1) * 100;
            return {
                valor: diff,
                percentual: percent.toFixed(1),
                positivo: diff >= 0
            };
        }

        // Carregar dados da URL ou usar defaults
        function carregarDados() {
            const urlParams = new URLSearchParams(window.location.search);
            const dadosCodificados = urlParams.get('dados');

            if (dadosCodificados) {
                try {
                    const dados = JSON.parse(atob(dadosCodificados));
                    return dados;
                } catch (e) {
                    console.error('Erro ao decodificar dados:', e);
                    return null;
                }
            }

            // Dados padr√£o (fallback)
            return {
                mes: "Fevereiro 2026",
                nmrr: { atual: 0, meta: 1 },
                vendas: { atual: 0, meta: 1 },
                conversao: { atual: 0, meta: 1 },
                pipelineMorno: { valor: 0, meta: 1 },
                pipelineQuente: { valor: 0, meta: 1 },
                mensagem: "Configure os dados via painel administrativo"
            };
        }

        // Renderizar dashboard
        function renderizar() {
            const dados = carregarDados();
            const app = document.getElementById('app');

            if (!dados) {
                app.innerHTML = `
                    <div class="erro-dados">
                        <h2>‚ö†Ô∏è Erro ao carregar dados</h2>
                        <p>Verifique se o link est√° correto ou gere um novo no painel administrativo.</p>
                    </div>
                `;
                return;
            }

            // Calcular varia√ß√µes
            const nmrrVar = calcularVariacao(dados.nmrr.atual, dados.nmrr.meta);
            const vendasVar = calcularVariacao(dados.vendas.atual, dados.vendas.meta);
            const convVar = calcularVariacao(dados.conversao.atual, dados.conversao.meta);

            app.innerHTML = `
                <div class="dashboard">
                    <header>
                        <h1>üìä Dashboard de Vendas</h1>
                        <div class="mes-atual">Meta Mensal: ${dados.mes}</div>
                    </header>

                    <main>
                        <div class="grid-cards">
                            <div class="card">
                                <div class="card-title">üí∞ NMRR</div>
                                <div class="card-value">${formatarMoeda(dados.nmrr.atual)}</div>
                                <div class="card-meta">Meta: ${formatarMoeda(dados.nmrr.meta)}</div>
                                <span class="variacao ${nmrrVar.positivo ? 'positivo' : 'negativo'}">
                                    ${nmrrVar.positivo ? '+' : ''}${formatarMoeda(nmrrVar.valor)} (${nmrrVar.positivo ? '+' : ''}${nmrrVar.percentual}%)
                                </span>
                            </div>

                            <div class="card">
                                <div class="card-title">üéØ Vendas Realizadas</div>
                                <div class="card-value">${dados.vendas.atual}</div>
                                <div class="card-meta">Meta: ${dados.vendas.meta}</div>
                                <span class="variacao ${vendasVar.positivo ? 'positivo' : 'negativo'}">
                                    ${vendasVar.positivo ? '+' : ''}${vendasVar.valor} un (${vendasVar.positivo ? '+' : ''}${vendasVar.percentual}%)
                                </span>
                            </div>

                            <div class="card">
                                <div class="card-title">üìà Taxa de Convers√£o</div>
                                <div class="card-value">${dados.conversao.atual}%</div>
                                <div class="card-meta">Meta: ${dados.conversao.meta}%</div>
                                <span class="variacao ${convVar.positivo ? 'positivo' : 'negativo'}">
                                    ${convVar.positivo ? '+' : ''}${convVar.valor}% (${convVar.positivo ? '+' : ''}${convVar.percentual}%)
                                </span>
                            </div>
                        </div>

                        <div class="pipelines">
                            <div class="pipeline-card pipeline-morno">
                                <div class="pipeline-title">üî• Pipeline Morno</div>
                                <div class="pipeline-value">${formatarMoeda(dados.pipelineMorno.valor)}</div>
                                <div>Meta Geral: ${formatarMoeda(dados.pipelineMorno.meta)}</div>
                            </div>

                            <div class="pipeline-card pipeline-quente">
                                <div class="pipeline-title">üöÄ Pipeline Quente</div>
                                <div class="pipeline-value">${formatarMoeda(dados.pipelineQuente.valor)}</div>
                                <div>Meta Geral: ${formatarMoeda(dados.pipelineQuente.meta)}</div>
                            </div>
                        </div>
                    </main>

                    <footer>
                        <div class="mensagem-motivacional">"${dados.mensagem}"</div>
                    </footer>
                </div>
            `;
        }

        // Inicializar
        renderizar();

        // Auto-atualiza√ß√£o opcional (a cada 5 minutos)
        setInterval(() => {
            location.reload();
        }, 300000);
    </script>
</body>
</html>
